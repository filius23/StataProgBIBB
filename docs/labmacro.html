<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>4 Label- und Variablenfunktionen | Stata für Fortgeschrittene: Programmieren mit Postestimates, Macros und Schleifen in Stata</title>
  <meta name="description" content="This is a minimal example of using the bookdown package to write a book. The output format for this example is bookdown::gitbook." />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="4 Label- und Variablenfunktionen | Stata für Fortgeschrittene: Programmieren mit Postestimates, Macros und Schleifen in Stata" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is a minimal example of using the bookdown package to write a book. The output format for this example is bookdown::gitbook." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="4 Label- und Variablenfunktionen | Stata für Fortgeschrittene: Programmieren mit Postestimates, Macros und Schleifen in Stata" />
  
  <meta name="twitter:description" content="This is a minimal example of using the bookdown package to write a book. The output format for this example is bookdown::gitbook." />
  

<meta name="author" content="Andreas Filser" />


<meta name="date" content="2021-12-12" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="regres.html"/>

<script src="libs/header-attrs-2.11/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Stata @ BIBB</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Herzlich Willkommen</a></li>
<li class="chapter" data-level="1" data-path="macro.html"><a href="macro.html"><i class="fa fa-check"></i><b>1</b> Macros</a>
<ul>
<li class="chapter" data-level="1.1" data-path="macro.html"><a href="macro.html#macht-einen-unterschied"><i class="fa fa-check"></i><b>1.1</b> <code>=</code> macht einen Unterschied</a></li>
<li class="chapter" data-level="1.2" data-path="macro.html"><a href="macro.html#local-und-global-sind-getrennte-welten"><i class="fa fa-check"></i><b>1.2</b> <code>local</code> und <code>global</code> sind getrennte Welten</a></li>
<li class="chapter" data-level="1.3" data-path="macro.html"><a href="macro.html#macros-mit-text"><i class="fa fa-check"></i><b>1.3</b> Macros mit Text</a></li>
<li class="chapter" data-level="1.4" data-path="macro.html"><a href="macro.html#dateipfade"><i class="fa fa-check"></i><b>1.4</b> Dateipfade</a></li>
<li class="chapter" data-level="1.5" data-path="macro.html"><a href="macro.html#cmac"><i class="fa fa-check"></i><b>1.5</b> Bereits definierte Macros</a>
<ul>
<li class="chapter" data-level="1.5.1" data-path="macro.html"><a href="macro.html#if1"><i class="fa fa-check"></i><b>1.5.1</b> <code>if</code></a></li>
<li class="chapter" data-level="1.5.2" data-path="macro.html"><a href="macro.html#macros-als-variablennamen-und-befehle"><i class="fa fa-check"></i><b>1.5.2</b> Macros als Variablennamen und Befehle</a></li>
<li class="chapter" data-level="1.5.3" data-path="macro.html"><a href="macro.html#allglo"><i class="fa fa-check"></i><b>1.5.3</b> <code>globals</code> durchsuchen</a></li>
</ul></li>
<li class="chapter" data-level="1.6" data-path="macro.html"><a href="macro.html#wenn-nicht-if-dann-else"><i class="fa fa-check"></i><b>1.6</b> Wenn nicht <code>if</code>, dann <code>else</code></a></li>
<li class="chapter" data-level="1.7" data-path="macro.html"><a href="macro.html#schleifen-foreach-forvalues"><i class="fa fa-check"></i><b>1.7</b> Schleifen: <code>foreach</code> &amp; <code>forvalues</code></a>
<ul>
<li class="chapter" data-level="1.7.1" data-path="macro.html"><a href="macro.html#ferest"><i class="fa fa-check"></i><b>1.7.1</b> <code>ferest()</code></a></li>
<li class="chapter" data-level="1.7.2" data-path="macro.html"><a href="macro.html#weitere-schleifentypen"><i class="fa fa-check"></i><b>1.7.2</b> Weitere Schleifentypen</a></li>
<li class="chapter" data-level="1.7.3" data-path="macro.html"><a href="macro.html#anwendung"><i class="fa fa-check"></i><b>1.7.3</b> Anwendung</a></li>
<li class="chapter" data-level="1.7.4" data-path="macro.html"><a href="macro.html#schleifen-aufbauen"><i class="fa fa-check"></i><b>1.7.4</b> Schleifen aufbauen</a></li>
<li class="chapter" data-level="1.7.5" data-path="macro.html"><a href="macro.html#nested-loop"><i class="fa fa-check"></i><b>1.7.5</b> nested loop</a></li>
<li class="chapter" data-level="1.7.6" data-path="macro.html"><a href="macro.html#display-vs.-macro-list"><i class="fa fa-check"></i><b>1.7.6</b> <code>display</code> vs. <code>macro list</code></a></li>
</ul></li>
<li class="chapter" data-level="1.8" data-path="macro.html"><a href="macro.html#übungen"><i class="fa fa-check"></i><b>1.8</b> Übungen</a>
<ul>
<li class="chapter" data-level="1.8.1" data-path="macro.html"><a href="macro.html#ue1"><i class="fa fa-check"></i><b>1.8.1</b> Übung</a></li>
<li class="chapter" data-level="1.8.2" data-path="macro.html"><a href="macro.html#ue2"><i class="fa fa-check"></i><b>1.8.2</b> FizzBuzz-Challenge</a></li>
<li class="chapter" data-level="1.8.3" data-path="macro.html"><a href="macro.html#ue3"><i class="fa fa-check"></i><b>1.8.3</b> Übung</a></li>
</ul></li>
<li class="chapter" data-level="1.9" data-path="macro.html"><a href="macro.html#anhang"><i class="fa fa-check"></i><b>1.9</b> Anhang</a>
<ul>
<li class="chapter" data-level="1.9.1" data-path="macro.html"><a href="macro.html#dir"><i class="fa fa-check"></i><b>1.9.1</b> Windows Dateipfade mit macros</a></li>
<li class="chapter" data-level="1.9.2" data-path="macro.html"><a href="macro.html#debugging-wo-ist-der-wurm-drin"><i class="fa fa-check"></i><b>1.9.2</b> Debugging: Wo ist der Wurm drin?</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="loopmacro.html"><a href="loopmacro.html"><i class="fa fa-check"></i><b>2</b> Schleifen aus Macros</a>
<ul>
<li class="chapter" data-level="2.1" data-path="loopmacro.html"><a href="loopmacro.html#local-erstellen-und-für-schleifen-verwenden"><i class="fa fa-check"></i><b>2.1</b> local erstellen und für Schleifen verwenden</a></li>
<li class="chapter" data-level="2.2" data-path="loopmacro.html"><a href="loopmacro.html#informationen-aus-schleifen-behalten"><i class="fa fa-check"></i><b>2.2</b> Informationen aus Schleifen behalten</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="loopmacro.html"><a href="loopmacro.html#gespeichterte-ergebnisse"><i class="fa fa-check"></i><b>2.2.1</b> Gespeichterte Ergebnisse</a></li>
<li class="chapter" data-level="2.2.2" data-path="loopmacro.html"><a href="loopmacro.html#e-und-r-sind-getrennte-welten"><i class="fa fa-check"></i><b>2.2.2</b> <code>e()</code> und <code>r()</code> sind getrennte Welten</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="loopmacro.html"><a href="loopmacro.html#ergebnisse-weiter-verwenden"><i class="fa fa-check"></i><b>2.3</b> Ergebnisse weiter verwenden</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="loopmacro.html"><a href="loopmacro.html#recur"><i class="fa fa-check"></i><b>2.3.1</b> Rekursivität</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="loopmacro.html"><a href="loopmacro.html#mat1"><i class="fa fa-check"></i><b>2.4</b> Kennzahlen in einer <code>matrix</code> ablegen</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="loopmacro.html"><a href="loopmacro.html#namen-für-spalten-und-zeilen-einer-matrix"><i class="fa fa-check"></i><b>2.4.1</b> Namen für Spalten und Zeilen einer <code>matrix</code></a></li>
<li class="chapter" data-level="2.4.2" data-path="loopmacro.html"><a href="loopmacro.html#zeile-einfügen"><i class="fa fa-check"></i><b>2.4.2</b> Zeile einfügen</a></li>
<li class="chapter" data-level="2.4.3" data-path="loopmacro.html"><a href="loopmacro.html#matrix-befüllen"><i class="fa fa-check"></i><b>2.4.3</b> <code>matrix</code> befüllen</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="loopmacro.html"><a href="loopmacro.html#labels-behalten"><i class="fa fa-check"></i><b>2.5</b> Labels behalten</a>
<ul>
<li class="chapter" data-level="2.5.1" data-path="loopmacro.html"><a href="loopmacro.html#labfun"><i class="fa fa-check"></i><b>2.5.1</b> <code>extended macro function</code> für Labels</a></li>
<li class="chapter" data-level="2.5.2" data-path="loopmacro.html"><a href="loopmacro.html#labels-als-rowname"><i class="fa fa-check"></i><b>2.5.2</b> Labels als <code>rowname</code></a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="loopmacro.html"><a href="loopmacro.html#von-der-matrix-zum-datensatz"><i class="fa fa-check"></i><b>2.6</b> Von der <code>matrix</code> zum Datensatz</a></li>
<li class="chapter" data-level="2.7" data-path="loopmacro.html"><a href="loopmacro.html#frame"><i class="fa fa-check"></i><b>2.7</b> <code>frame</code>: mehrere Datensätze in Stata</a></li>
<li class="chapter" data-level="2.8" data-path="loopmacro.html"><a href="loopmacro.html#übungen-1"><i class="fa fa-check"></i><b>2.8</b> Übungen</a>
<ul>
<li class="chapter" data-level="2.8.1" data-path="loopmacro.html"><a href="loopmacro.html#retue1"><i class="fa fa-check"></i><b>2.8.1</b> Übung</a></li>
<li class="chapter" data-level="2.8.2" data-path="loopmacro.html"><a href="loopmacro.html#retue2"><i class="fa fa-check"></i><b>2.8.2</b> Übung</a></li>
<li class="chapter" data-level="2.8.3" data-path="loopmacro.html"><a href="loopmacro.html#retue3"><i class="fa fa-check"></i><b>2.8.3</b> Übung</a></li>
<li class="chapter" data-level="2.8.4" data-path="loopmacro.html"><a href="loopmacro.html#retue4"><i class="fa fa-check"></i><b>2.8.4</b> Übung</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="regres.html"><a href="regres.html"><i class="fa fa-check"></i><b>3</b> Regressionsergebnisse weiterverarbeiten</a>
<ul>
<li class="chapter" data-level="3.1" data-path="regres.html"><a href="regres.html#e-und-r-der-regressionsergebnisse"><i class="fa fa-check"></i><b>3.1</b> <code>e()</code> und <code>r()</code> der Regressionsergebnisse</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="regres.html"><a href="regres.html#koeffizienten-mit-_b-_se-aufrufen"><i class="fa fa-check"></i><b>3.1.1</b> Koeffizienten mit <code>_b</code> / <code>_se</code> aufrufen</a></li>
<li class="chapter" data-level="3.1.2" data-path="regres.html"><a href="regres.html#komplette-regressionstabelle"><i class="fa fa-check"></i><b>3.1.2</b> Komplette Regressionstabelle</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="regres.html"><a href="regres.html#regressionstabellen-als-matrix-speichern-und-anpassen"><i class="fa fa-check"></i><b>3.2</b> Regressionstabellen als <code>matrix</code> speichern und anpassen</a></li>
<li class="chapter" data-level="3.3" data-path="regres.html"><a href="regres.html#kategoriale-uv"><i class="fa fa-check"></i><b>3.3</b> kategoriale UV</a></li>
<li class="chapter" data-level="3.4" data-path="regres.html"><a href="regres.html#als-datensatz-ablegen"><i class="fa fa-check"></i><b>3.4</b> Als Datensatz ablegen:</a></li>
<li class="chapter" data-level="3.5" data-path="regres.html"><a href="regres.html#weitere-infos-aus-e"><i class="fa fa-check"></i><b>3.5</b> weitere Infos aus <code>e()</code></a></li>
<li class="chapter" data-level="3.6" data-path="regres.html"><a href="regres.html#reg-loop"><i class="fa fa-check"></i><b>3.6</b> <code>reg</code>-Loop</a></li>
<li class="chapter" data-level="3.7" data-path="regres.html"><a href="regres.html#übungen-2"><i class="fa fa-check"></i><b>3.7</b> Übungen</a></li>
<li class="chapter" data-level="3.8" data-path="regres.html"><a href="regres.html#anhang-1"><i class="fa fa-check"></i><b>3.8</b> Anhang</a>
<ul>
<li class="chapter" data-level="3.8.1" data-path="regres.html"><a href="regres.html#statsby"><i class="fa fa-check"></i><b>3.8.1</b> <code>statsby</code></a></li>
<li class="chapter" data-level="3.8.2" data-path="regres.html"><a href="regres.html#weitere-matrix-befehle"><i class="fa fa-check"></i><b>3.8.2</b> weitere <code>matrix</code>-Befehle</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="labmacro.html"><a href="labmacro.html"><i class="fa fa-check"></i><b>4</b> Label- und Variablenfunktionen</a>
<ul>
<li class="chapter" data-level="4.1" data-path="labmacro.html"><a href="labmacro.html#stringfunktionen"><i class="fa fa-check"></i><b>4.1</b> Stringfunktionen</a></li>
<li class="chapter" data-level="4.2" data-path="labmacro.html"><a href="labmacro.html#arbeiten-mit-regular-expressions"><i class="fa fa-check"></i><b>4.2</b> Arbeiten mit “Regular Expressions”</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="labmacro.html"><a href="labmacro.html#regex-grund-regeln"><i class="fa fa-check"></i><b>4.2.1</b> regex (Grund-)Regeln</a></li>
<li class="chapter" data-level="4.2.2" data-path="labmacro.html"><a href="labmacro.html#beispiele"><i class="fa fa-check"></i><b>4.2.2</b> Beispiele</a></li>
<li class="chapter" data-level="4.2.3" data-path="labmacro.html"><a href="labmacro.html#weiterführende-links"><i class="fa fa-check"></i><b>4.2.3</b> Weiterführende Links</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="labmacro.html"><a href="labmacro.html#labfuns"><i class="fa fa-check"></i><b>4.3</b> Label bearbeiten</a></li>
<li class="chapter" data-level="4.4" data-path="labmacro.html"><a href="labmacro.html#abgleiche"><i class="fa fa-check"></i><b>4.4</b> Abgleiche</a></li>
<li class="chapter" data-level="4.5" data-path="labmacro.html"><a href="labmacro.html#valsearch"><i class="fa fa-check"></i><b>4.5</b> wo kommt überall -4 vor?</a></li>
<li class="chapter" data-level="4.6" data-path="labmacro.html"><a href="labmacro.html#übungen-3"><i class="fa fa-check"></i><b>4.6</b> Übungen</a>
<ul>
<li class="chapter" data-level="4.6.1" data-path="labmacro.html"><a href="labmacro.html#regexue"><i class="fa fa-check"></i><b>4.6.1</b> Übung</a></li>
<li class="chapter" data-level="4.6.2" data-path="labmacro.html"><a href="labmacro.html#varlab"><i class="fa fa-check"></i><b>4.6.2</b> Übung</a></li>
<li class="chapter" data-level="4.6.3" data-path="labmacro.html"><a href="labmacro.html#valuesearch"><i class="fa fa-check"></i><b>4.6.3</b> Übung</a></li>
</ul></li>
<li class="chapter" data-level="4.7" data-path="labmacro.html"><a href="labmacro.html#anhang-2"><i class="fa fa-check"></i><b>4.7</b> Anhang</a>
<ul>
<li class="chapter" data-level="4.7.1" data-path="labmacro.html"><a href="labmacro.html#wörter-aus-einem-satz"><i class="fa fa-check"></i><b>4.7.1</b> Wörter aus einem Satz</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Stata für Fortgeschrittene: Programmieren mit Postestimates, Macros und Schleifen in Stata</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="labmacro" class="section level1" number="4">
<h1><span class="header-section-number">4</span> Label- und Variablenfunktionen</h1>
<p>Inspiriert von der <a href="https://stats.idre.ucla.edu/stata/faq/how-can-i-extract-a-portion-of-a-string-variable-using-regular-expressions/">UCLA</a> einige Beispielstrings:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb1-1"><a href="labmacro.html#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="kw">clear</span> <span class="ot">all</span></span>
<span id="cb1-2"><a href="labmacro.html#cb1-2" aria-hidden="true" tabindex="-1"></a>input str60 add</span>
<span id="cb1-3"><a href="labmacro.html#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;4905 Lakeway Drive, College Station, Texas 77845 USA&quot;</span></span>
<span id="cb1-4"><a href="labmacro.html#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;673 Jasmine Street, Los Angeles, CA 90024&quot;</span></span>
<span id="cb1-5"><a href="labmacro.html#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;2376 First street, San Diego, CA 90126&quot;</span></span>
<span id="cb1-6"><a href="labmacro.html#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;6 West Central St, Tempe AZ 80068&quot;</span></span>
<span id="cb1-7"><a href="labmacro.html#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;1234 Main St. Cambridge, MA 01238-1234&quot;</span></span>
<span id="cb1-8"><a href="labmacro.html#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;Robert-Schuman-Platz 3, 53175 Bonn GERMANY&quot;</span></span>
<span id="cb1-9"><a href="labmacro.html#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;Regensburger Straße 100, 90478 Nürnberg Germany&quot;</span></span>
<span id="cb1-10"><a href="labmacro.html#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;  Ammerländer Heerstraße 114-118, 26129 Oldenburg GERMANY  &quot;</span></span>
<span id="cb1-11"><a href="labmacro.html#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code></pre></div>
<div id="stringfunktionen" class="section level2" number="4.1">
<h2><span class="header-section-number">4.1</span> Stringfunktionen</h2>
<p><code>help string functions</code></p>
<div class="sourceCode" id="cb2"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb2-1"><a href="labmacro.html#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> x1 = <span class="fu">substr</span>(add,5,10)   <span class="co">//  substring von add -&gt; Zeichen 5-10</span></span>
<span id="cb2-2"><a href="labmacro.html#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> <span class="kw">x2</span> = <span class="fu">wordcount</span>(add)       <span class="co">// Worte zählen</span></span>
<span id="cb2-3"><a href="labmacro.html#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> x3 = <span class="fu">word</span>(add,5)      <span class="co">// 5. Wort</span></span>
<span id="cb2-4"><a href="labmacro.html#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> x4 = <span class="fu">upper</span>(add)         <span class="co">// alles groß</span></span>
<span id="cb2-5"><a href="labmacro.html#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> x5 = <span class="fu">lower</span>(add)     <span class="co">// alles klein</span></span>
<span id="cb2-6"><a href="labmacro.html#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> x6 = <span class="fu">proper</span>(add)    <span class="co">// jeweiles erster Buchstabe eines Wortes groß</span></span>
<span id="cb2-7"><a href="labmacro.html#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> x7 = <span class="kw">trim</span>(add)      <span class="co">// Leerzeichen am Ende und Beginn raus</span></span></code></pre></div>
<p>Allerdings sind diese Funktionen auf ASCII-Zeichen ausgelegt - einfach gesagt: Umlaute, ß usw. bereiten Probleme. Daher gibt es eine Erweiterung mit <code>usubstr</code>, <code>ustrupper()</code>, <code>ustrlower()</code> usw. - mehr dazu jeweils in der Hilfe.</p>
<p>Der Weg zur passenden <code>regex</code> string-Funktion ist leider oft von vielen Versuchen begleitet, am einfachsten testet man mit <code>display</code>.
So zeigt sich hier bspw., dass <code>proper()</code> hier “ß” und “ü” als Wortende/-beginn (mis-)versteht:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb3-1"><a href="labmacro.html#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">display</span> <span class="fu">proper</span>(<span class="st">&quot;Regensburger Straße 100, 90478 nüRnberg germany&quot;</span>)</span></code></pre></div>
<pre><code>Regensburger StraßE 100, 90478 NüRnberg Germany</code></pre>
<p>…in der Hilfe finden wir <code>ustrtitle</code>:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb5-1"><a href="labmacro.html#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">display</span> ustrtitle(<span class="st">&quot;Regensburger Straße 100, 90478 nüRnberg germany&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb6-1"><a href="labmacro.html#cb6-1" aria-hidden="true" tabindex="-1"></a>Regensburger Straße 100, 90478 Nürnberg Germany</span></code></pre></div>
<p>Hier wenig hilfreich, aber häufig eine gute Abkürzung: <code>split</code></p>
<div class="sourceCode" id="cb7"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb7-1"><a href="labmacro.html#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="kw">split</span> add, <span class="kw">parse</span>(<span class="st">&quot; &quot;</span>) <span class="kw">gen</span>(t)</span></code></pre></div>
</div>
<div id="arbeiten-mit-regular-expressions" class="section level2" number="4.2">
<h2><span class="header-section-number">4.2</span> Arbeiten mit “Regular Expressions”</h2>
<p>“regular expressions” oder “regex” sind eine flexible Methode, strings (also Textinhalte) zu durchsuchen.
Dabei suchen wir nach Mustern anstelle eines exakten matchings.</p>
<p>In Stata können wir regex für Variablen, aber auch für macros und Labels verwenden.
regex sind aber nicht immer die (einfachste) Lösung und oft werden die Befehle sehr unübersichtlich.
Daher hier nur ein kurzer Überblick.</p>
<p>Die drei Hauptfunktionen in Stata finden wir unter <code>help regex</code>:</p>
<blockquote>
<p><code>regexm(s,re)</code> allows you to search for the string described in your regular expressions. It evaluates to 1 if the string matches the expression.</p>
</blockquote>
<blockquote>
<p><code>regexs(n)</code> returns the nth substring within an expression matched by regexm (hence, <code>regexm</code> must always be run before regexs).</p>
</blockquote>
<blockquote>
<p><code>regexr(s1,re,s2)</code> searches for re within the string (s1) and replaces the matching portion with a new string (s2).</p>
</blockquote>
<p>Allerdings sind diese Funktionen auf ASCII-Zeichen ausgelegt - einfach gesagt: Umlaute, ß usw. bereiten Probleme. Daher gibt es eine Erweiterung mit <code>ustrregexm</code>, <code>ustrregexs</code>, <code>ustrregexrf</code> und <code>ustrregexra</code>.
Auf die konzentrieren wir uns hier.</p>
<div id="regex-grund-regeln" class="section level3" number="4.2.1">
<h3><span class="header-section-number">4.2.1</span> regex (Grund-)Regeln</h3>
<p>regex basieren auf einer Reihe an Zeichen, mit Hilfe derer wir strings durchsuchen können:</p>
<ul>
<li><code>\d</code> matcht eine Zahl</li>
<li><code>\w</code> matcht “alphanumeric characters” (Buchstaben &amp; Zahlen)</li>
<li><code>\s</code> matcht ein Leerzeichen</li>
<li><code>^</code> “matche Ausdruck am Anfang des strings”</li>
<li><code>$</code> “matche Ausdruck am Ende des strings”</li>
<li><code>-</code> lässt eine <em>range</em> zu: <code>a-z</code>, <code>0-9</code>, <code>5-8</code>, <code>F-M</code> etc.</li>
<li><code>.</code> bedeutet “matche irgendein Zeichen”</li>
<li><code>\</code> ist ein “escape character” für Zeichen, die ansonsten als regex-Operator verstanden würden</li>
<li><code>|</code> oder-Operator</li>
<li><code>[]</code> use in matching, such as <code>[a-zA-Z0-9]</code> for all alphanumeric characters</li>
<li><code>()</code> darin angegebene Werte können wir mit <code>ustrregexs</code> extrahieren</li>
<li><code>*</code> “matche 0 oder öfter” für den vorhergehenden Ausdruck</li>
<li><code>+</code> “matche 1 oder öfter” für den vorhergehenden Ausdruck</li>
</ul>
</div>
<div id="beispiele" class="section level3" number="4.2.2">
<h3><span class="header-section-number">4.2.2</span> Beispiele</h3>
<p>Inspiriert von der <a href="https://stats.idre.ucla.edu/stata/faq/how-can-i-extract-a-portion-of-a-string-variable-using-regular-expressions/">UCLA</a> einige Beispielstrings:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb8-1"><a href="labmacro.html#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">clear</span> <span class="ot">all</span></span>
<span id="cb8-2"><a href="labmacro.html#cb8-2" aria-hidden="true" tabindex="-1"></a>input str60 add</span>
<span id="cb8-3"><a href="labmacro.html#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;4905 Lakeway Drive, College Station, Texas 77845 USA&quot;</span></span>
<span id="cb8-4"><a href="labmacro.html#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;673 Jasmine Street, Los Angeles, CA 90024&quot;</span></span>
<span id="cb8-5"><a href="labmacro.html#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;2376 First street, San Diego, CA 90126&quot;</span></span>
<span id="cb8-6"><a href="labmacro.html#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;6 West Central St, Tempe AZ 80068&quot;</span></span>
<span id="cb8-7"><a href="labmacro.html#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;1234 Main St. Cambridge, MA 01238-1234&quot;</span></span>
<span id="cb8-8"><a href="labmacro.html#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;Robert-Schuman-Platz 3, 53175 Bonn GERMANY&quot;</span></span>
<span id="cb8-9"><a href="labmacro.html#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;Regensburger Straße 100, 90478 Nürnberg Germany&quot;</span></span>
<span id="cb8-10"><a href="labmacro.html#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;Ammerländer Heerstraße 114-118, 26129 Oldenburg GERMANY&quot;</span></span>
<span id="cb8-11"><a href="labmacro.html#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb9-1"><a href="labmacro.html#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> <span class="kw">d</span> = ustrregexm(add, <span class="st">&quot;GERMANY|Germany&quot;</span>)</span></code></pre></div>
<p>Das <code>m</code> in <code>ustrregexm</code> steht für match.
Mit <code>ustrregexm</code> können wir nach Zeichenketten suchen.
Wenn sie gefunden wird, wird eine 1 zurückzugeben, andernfalls 0.
Hier suchen wir nach “entweder GERMANY <em>oder</em> Germany.”</p>
<p>Wir können aber auch den gefundenen Inhalt extrahieren.
Bei Übereinstimmungen werden die matches gespeichert, darauf können wir mit <code>ustrregexs</code> zurückgreifen:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb10-1"><a href="labmacro.html#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> d2 = ustrregexs(0) <span class="kw">if</span> ustrregexm(add, <span class="st">&quot;GERMANY|Germany&quot;</span>)</span></code></pre></div>
<p><code>s</code> steht für subexpressions (oder “tokens”).
Token 0 enthält alle übereinstimmenden Muster.
Wird eine Zeichenkette mehrfach gefunden, dann enthält Token 0 alle Übereinstimmungen, Token 1 die erste, Token 2 die zweite und so weiter.</p>
<p><code>ustrregexrf</code> und <code>ustrregexra</code> helfen uns schließlich, Inhalte zu ersetzen.
<code>rf</code> bzw. <code>ra</code> stehen dabei für “replace first” bzw. “replace all.”
<code>ustrregexrf</code> ersetzt also nur den ersten match, <code>ustrregexra</code> hingegen alle.</p>
<p>Basierend auf den Regeln von oben ergeben diese beiden Befehle unterschiedliche Ergebnisse:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb11-1"><a href="labmacro.html#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> s1 = ustrregexra(add, <span class="st">&quot;street&quot;</span>,   <span class="st">&quot;!&quot;</span>)</span>
<span id="cb11-2"><a href="labmacro.html#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> s2 = ustrregexra(add, <span class="st">&quot;[street]&quot;</span>, <span class="st">&quot;!&quot;</span>)</span></code></pre></div>
<p>In <code>s1</code> wurden alle matches “street” gelöscht und durch ! ersetzt.
In <code>s2</code> wurden alle matches von “s,”“t,”“r,”“e” und “t” gelöscht und durch ! ersetzt.</p>
<p>Weitere Beispiele für ersetzen mit regex-Regelausdrücken - siehe DoFile:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb12-1"><a href="labmacro.html#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> z1 =  ustrregexra(add, <span class="st">&quot;\w&quot;</span>, <span class="st">&quot;&quot;</span>) <span class="co">// alle alphanumeric ersetzen</span></span>
<span id="cb12-2"><a href="labmacro.html#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> z2 = ustrregexra(add, <span class="st">&quot;\W&quot;</span>, <span class="st">&quot;&quot;</span>) <span class="co">// alle nicht-alphanumeric ersetzen</span></span>
<span id="cb12-3"><a href="labmacro.html#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> z3 =  ustrregexra(add, <span class="st">&quot;\d&quot;</span>, <span class="st">&quot;&quot;</span>) <span class="co">// alle Zahlen ersetzen </span></span>
<span id="cb12-4"><a href="labmacro.html#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> z4 = ustrregexra(add, <span class="st">&quot;\D&quot;</span>, <span class="st">&quot;&quot;</span>) <span class="co">// alle nicht-Zahlen ersetzen </span></span>
<span id="cb12-5"><a href="labmacro.html#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> z5 = ustrregexra(add, <span class="st">&quot;.+,&quot;</span>, <span class="st">&quot;&quot;</span>) <span class="co">// alles vor dem Komma ersetzen</span></span>
<span id="cb12-6"><a href="labmacro.html#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> z6 = ustrregexra(add, <span class="st">&quot;,.+&quot;</span>, <span class="st">&quot;&quot;</span>) <span class="co">// alles nach dem Komma ersetzen</span></span></code></pre></div>
<p>Nach Zahlen suchen:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb13-1"><a href="labmacro.html#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> r1 = ustrregexs(0) <span class="kw">if</span> ustrregexm(add, <span class="st">&quot;\d&quot;</span>)  <span class="co">// Zahl</span></span>
<span id="cb13-2"><a href="labmacro.html#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> r2 = ustrregexs(0) <span class="kw">if</span> ustrregexm(add, <span class="st">&quot;\d+&quot;</span>) <span class="co">// Zahlenfolge</span></span>
<span id="cb13-3"><a href="labmacro.html#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> r3 = ustrregexs(0) <span class="kw">if</span> ustrregexm(add, <span class="st">&quot;(\d{5})&quot;</span>) <span class="co">// 5-stellige Zahl</span></span>
<span id="cb13-4"><a href="labmacro.html#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> r4 = ustrregexs(0) <span class="kw">if</span> ustrregexm(add, <span class="st">&quot;^(\d+)&quot;</span>) <span class="co">// Zahlenfolge am Anfang</span></span>
<span id="cb13-5"><a href="labmacro.html#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> r5 = ustrregexs(0) <span class="kw">if</span> ustrregexm(add, <span class="st">&quot;(\d+).*(\d+)&quot;</span>) <span class="co">// Zahlenfolgen und alles was dazwischen kommt </span></span>
<span id="cb13-6"><a href="labmacro.html#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> r6 = ustrregexs(0) <span class="kw">if</span> ustrregexm(r5, <span class="st">&quot;(\d+)$&quot;</span>) <span class="co">// Zahlenfolge am Ende -&gt; aus r5!</span></span></code></pre></div>
</div>
<div id="weiterführende-links" class="section level3" number="4.2.3">
<h3><span class="header-section-number">4.2.3</span> Weiterführende Links</h3>
<p><a href="https://github.com/asjadnaqvi/The-Stata-Guide/blob/master/Stata_regex_cheatsheet_v1.pdf">Hier</a> findet sich ein sehr gutes “Cheatsheet” zu den gebräuchlichsten regex.
Das zugehörige <a href="https://medium.com/the-stata-guide/regular-expressions-regex-in-stata-6e5c200ef27c">Tutorial</a> ist ebenfalls sehr lesenswert.
Die Übersicht der <a href="https://stats.idre.ucla.edu/stata/faq/how-can-i-extract-a-portion-of-a-string-variable-using-regular-expressions/">UCLA</a> bietet auch nochmal einige Hinweise - allerdings auf Basis der ASCII-basierten Befehle.
<a href="http://www.stata.com/support/faqs/data/regex.html">Stata Hilfe</a></p>
<hr />
<p><strong><a href="labmacro.html#regexue">Übung 1</a></strong></p>
<hr />
</div>
</div>
<div id="labfuns" class="section level2" number="4.3">
<h2><span class="header-section-number">4.3</span> Label bearbeiten</h2>
<p>Um Informationen zu Variablen &amp; Labels abzurufen, stehen eine ganze Reihe an extended macro functions zur Verfügung:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb14-1"><a href="labmacro.html#cb14-1" aria-hidden="true" tabindex="-1"></a>loc v m1202</span>
<span id="cb14-2"><a href="labmacro.html#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="labmacro.html#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> vartype:     <span class="dv">type</span> <span class="ot">`v&#39;</span>                   <span class="co">// Variablen &quot;storage type&quot; (byte etc)</span></span>
<span id="cb14-4"><a href="labmacro.html#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> varlab:      <span class="kw">variable</span> <span class="kw">label</span> <span class="ot">`v&#39;</span> <span class="co">// variable label</span></span>
<span id="cb14-5"><a href="labmacro.html#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> vallabname:  <span class="ot">value</span> <span class="kw">label</span> <span class="ot">`v&#39;</span>    <span class="co">// Name des value label</span></span>
<span id="cb14-6"><a href="labmacro.html#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> vallab1 :    <span class="kw">label</span> (<span class="ot">`v&#39;</span>) 1            <span class="co">// Value label für Wert = 1</span></span></code></pre></div>
<p>Die so erstellten <code>local</code>s können wir dann in der bekannten Methode wieder darstellen:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb15-1"><a href="labmacro.html#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="kw">di</span> <span class="st">&quot;`vartype&#39;&quot;</span>     <span class="co">// display local &quot;vartype&quot;</span></span>
<span id="cb15-2"><a href="labmacro.html#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="kw">di</span> <span class="st">&quot;`varlab&#39;&quot;</span>      <span class="co">// display local &quot;varlabel&quot;</span></span>
<span id="cb15-3"><a href="labmacro.html#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="kw">di</span> <span class="st">&quot;`vallabname&#39;&quot;</span>  <span class="co">// display local &quot;valuelabname&quot;</span></span>
<span id="cb15-4"><a href="labmacro.html#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="kw">di</span> <span class="st">&quot;`vallab1&#39;&quot;</span>     <span class="co">// display local &quot;valuelab1&quot;</span></span></code></pre></div>
<p>Wir können die Labels und Eigenschaften von `v’ auch in einem Schritt anzeigen lassen, die Syntax sieht aber etwas eigenwillig aus:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb16-1"><a href="labmacro.html#cb16-1" aria-hidden="true" tabindex="-1"></a>loc v m1202</span>
<span id="cb16-2"><a href="labmacro.html#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="kw">di</span> <span class="st">&quot;`: type `v&#39;&#39;&quot;</span>                  <span class="co">// &quot;storage type&quot; (byte etc) der Variable</span></span>
<span id="cb16-3"><a href="labmacro.html#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="kw">di</span> <span class="st">&quot;`: variable label `v&#39;&#39;&quot;</span>  <span class="co">// variable label</span></span>
<span id="cb16-4"><a href="labmacro.html#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="kw">di</span> <span class="st">&quot;`: value label `v&#39;&#39;&quot;</span>         <span class="co">// Name des value label</span></span>
<span id="cb16-5"><a href="labmacro.html#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="kw">di</span> <span class="st">&quot;`: label (`v&#39;) 1&#39;&quot;</span>         <span class="co">// Value label für Wert = 1</span></span></code></pre></div>
<p>Damit können wir bspw. ein Label kürzen:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb17-1"><a href="labmacro.html#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> longlabel: <span class="kw">var</span> <span class="kw">label</span> m1202</span>
<span id="cb17-2"><a href="labmacro.html#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> shortlabel = <span class="fu">substr</span>(<span class="st">&quot;`longlabel&#39;&quot;</span>,1,10)</span>
<span id="cb17-3"><a href="labmacro.html#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="kw">label</span> <span class="kw">var</span> m1202 <span class="st">&quot;`shortlabel&#39;&quot;</span></span></code></pre></div>
<p>Mit <code>label copy oldname newname</code>, <code>local lblname: value label var</code> und <code>local lab1: label (var) level</code> können wir auch value-Labels bearbeiten:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb18-1"><a href="labmacro.html#cb18-1" aria-hidden="true" tabindex="-1"></a>loc v m1202 </span>
<span id="cb18-2"><a href="labmacro.html#cb18-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-3"><a href="labmacro.html#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> lblname: <span class="ot">value</span> <span class="kw">label</span> <span class="ot">`v&#39;</span>       <span class="co">// value label aufrufen</span></span>
<span id="cb18-4"><a href="labmacro.html#cb18-4" aria-hidden="true" tabindex="-1"></a>cap <span class="kw">label</span> <span class="kw">drop</span> <span class="ot">`lblname&#39;</span>_n           <span class="co">// neuen Namen zur Sicherheit droppen</span></span>
<span id="cb18-5"><a href="labmacro.html#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="kw">label</span> copy <span class="ot">`lblname&#39;</span> <span class="ot">`lblname&#39;</span>_n     <span class="co">// kopieren</span></span>
<span id="cb18-6"><a href="labmacro.html#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="kw">levelsof</span> <span class="ot">`v&#39;</span>, loc(x)                 <span class="co">// Werte für die Variable aufrufen</span></span>
<span id="cb18-7"><a href="labmacro.html#cb18-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-8"><a href="labmacro.html#cb18-8" aria-hidden="true" tabindex="-1"></a><span class="kw">foreach</span> lvl <span class="kw">of</span> <span class="kw">local</span> x {</span>
<span id="cb18-9"><a href="labmacro.html#cb18-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">local</span> lab1: <span class="kw">label</span> (<span class="ot">`v&#39;</span>) <span class="ot">`lvl&#39;</span>     <span class="co">// Value label Variable v bei Level lvl</span></span>
<span id="cb18-10"><a href="labmacro.html#cb18-10" aria-hidden="true" tabindex="-1"></a>    loc lab2 = <span class="fu">substr</span>(<span class="st">&quot;`lab1&#39;&quot;</span>,1,8)         <span class="co">// kürzen </span></span>
<span id="cb18-11"><a href="labmacro.html#cb18-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-12"><a href="labmacro.html#cb18-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">label</span> <span class="kw">define</span> <span class="ot">`lblname&#39;</span>_n <span class="ot">`lvl&#39;</span> <span class="st">&quot;`lab2&#39;&quot;</span>, modify <span class="co">// im value label ändern</span></span>
<span id="cb18-13"><a href="labmacro.html#cb18-13" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb18-14"><a href="labmacro.html#cb18-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-15"><a href="labmacro.html#cb18-15" aria-hidden="true" tabindex="-1"></a>lab val <span class="ot">`v&#39;</span> <span class="ot">`lblname&#39;</span>_n</span></code></pre></div>
<hr />
<p><strong><a href="labmacro.html#varlab">Übung 2</a></strong></p>
<hr />
</div>
<div id="abgleiche" class="section level2" number="4.4">
<h2><span class="header-section-number">4.4</span> Abgleiche</h2>
<p>Existiert eine Variable?</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb19-1"><a href="labmacro.html#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="kw">capture</span> <span class="kw">confirm</span>  <span class="kw">variable</span> lm02</span>
<span id="cb19-2"><a href="labmacro.html#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="kw">if</span> !<span class="dt">_rc</span> dis <span class="st">&quot;ja&quot;</span></span>
<span id="cb19-3"><a href="labmacro.html#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="kw">if</span> <span class="dt">_rc</span>  dis <span class="st">&quot;nein&quot;</span></span></code></pre></div>
<p>Ist variable numerisch?</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb20-1"><a href="labmacro.html#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="kw">capture</span> <span class="kw">confirm</span> <span class="kw">numeric</span> <span class="kw">variable</span> az</span>
<span id="cb20-2"><a href="labmacro.html#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="kw">if</span> !<span class="dt">_rc</span> dis <span class="st">&quot;ja&quot;</span></span>
<span id="cb20-3"><a href="labmacro.html#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="kw">if</span> <span class="dt">_rc</span>  dis <span class="st">&quot;nein&quot;</span></span></code></pre></div>
<pre><code>ja</code></pre>
<p><code>help data_types</code></p>
</div>
<div id="valsearch" class="section level2" number="4.5">
<h2><span class="header-section-number">4.5</span> wo kommt überall -4 vor?</h2>
<div class="sourceCode" id="cb22"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb22-1"><a href="labmacro.html#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="kw">quietly</span> <span class="kw">ds</span></span>
<span id="cb22-2"><a href="labmacro.html#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> varlist1 <span class="ot">`r(varlist)&#39;</span></span>
<span id="cb22-3"><a href="labmacro.html#cb22-3" aria-hidden="true" tabindex="-1"></a>*<span class="kw">display</span> <span class="st">&quot;`varlist1&#39;&quot;</span></span>
<span id="cb22-4"><a href="labmacro.html#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="kw">foreach</span> v <span class="kw">of</span> varlist1 {</span>
<span id="cb22-5"><a href="labmacro.html#cb22-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">qui</span> <span class="fu">count</span> <span class="kw">if</span> <span class="ot">`v&#39;</span> == -4</span>
<span id="cb22-6"><a href="labmacro.html#cb22-6" aria-hidden="true" tabindex="-1"></a>  <span class="kw">if</span> <span class="fu">r</span>(<span class="kw">N</span>) &gt; 0 <span class="kw">display</span> <span class="st">&quot;`v&#39;&quot;</span></span>
<span id="cb22-7"><a href="labmacro.html#cb22-7" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<hr />
<p><strong><a href="labmacro.html#valuesearch">Übung 3</a></strong></p>
<hr />
</div>
<div id="übungen-3" class="section level2" number="4.6">
<h2><span class="header-section-number">4.6</span> Übungen</h2>
<div id="regexue" class="section level3" number="4.6.1">
<h3><span class="header-section-number">4.6.1</span> Übung</h3>
<ul>
<li>Laden Sie den <code>regex.dta</code>: <code>use "https://github.com/filius23/StataProgBIBB/raw/main/docs/regex1.dta", clear</code> und teilen Sie die Informationen aus <code>address</code> in 4 Variablen auf: Hausnummer (erste Zahl), Straße, PLZ, Region
<ul>
<li>Wandeln Sie alle Einträge in Großbuchstaben um</li>
<li>Verwenden Sie <code>split</code>, um zwischen Adresse und PLZ &amp; Ort zu trennen</li>
<li>Wie können Sie jetzt die Zahlen vom Text trennen?</li>
<li>Löschen Sie ggf. Leerzeichen zu Beginn und am Ende der Variablen</li>
</ul></li>
</ul>
</div>
<div id="varlab" class="section level3" number="4.6.2">
<h3><span class="header-section-number">4.6.2</span> Übung</h3>
<ul>
<li><p>Laden Sie der Erwerbstätigenbefragung</p></li>
<li><p>Kürzen die die <code>variable labels</code> für alle Variablen mit “wissensintensiver Beruf” im Label (<code>d *wib*</code>)</p>
<ul>
<li>Ersetzen Sie “wissensintensiver Beruf” in den <code>variable labels</code> mit “wib.”</li>
<li>Spielen Sie die Routine erst für eine Variable durch: welche Label-Befehle brauchen Sie?</li>
<li>Denken Sie an <code>foreach ... of varlist</code> und die Möglichkeit, wildcards zu verwenden. Alternativ hilft evtl. auch <a href="labmacro.html#valsearch"><code>ds</code></a> mit Wildcards</li>
</ul></li>
<li><p>Bearbeiten Sie das value label für <code>nuts2</code> - nutzen Sie dafür die <code>regex</code> und <code>string</code>-Funktionen von oben</p>
<ul>
<li>Löschen Sie “Statistische” aus den den value labels und ersetzen Sie “Direktionsbezirk” durch “Bezirk”</li>
</ul></li>
</ul>
</div>
<div id="valuesearch" class="section level3" number="4.6.3">
<h3><span class="header-section-number">4.6.3</span> Übung</h3>
<ul>
<li>In welchen Variablen aus der Erwerbstätigenbefragung kommt der der Wert <code>-9</code> vor?</li>
<li>Füttern Sie diese Information in <code>mvdecode</code>, um die Missings zu überschreiben.
<ul>
<li>Sammeln Sie die Information, welche Variablen <code>-9</code> enthalten (Stichwort <a href="loopmacro.html#recur">rekursive macro-Definition</a>)</li>
<li>Erstellen Sie einen <code>mvdecode</code>-Befehle, welcher die Information aufnimmt und in allen gefundenen Variablen <code>-9</code> durch <code>.</code> ersetzt.</li>
</ul></li>
</ul>
</div>
</div>
<div id="anhang-2" class="section level2" number="4.7">
<h2><span class="header-section-number">4.7</span> Anhang</h2>
<div id="wörter-aus-einem-satz" class="section level3" number="4.7.1">
<h3><span class="header-section-number">4.7.1</span> Wörter aus einem Satz</h3>
<div class="sourceCode" id="cb23"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb23-1"><a href="labmacro.html#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> phrase <span class="st">`&quot;</span> <span class="st">&quot;2 guys&quot;</span> <span class="st">&quot;1 girl&quot;</span> <span class="st">&quot;1 pizza place&quot;</span> <span class="st">&quot;&#39;</span></span>
<span id="cb23-2"><a href="labmacro.html#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="st">di &quot;</span><span class="ot">`:word 2 of `phrase&#39;</span> &#39;<span class="st">&quot;</span></span></code></pre></div>
<pre><code>1 girl</code></pre>
<div class="sourceCode" id="cb25"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb25-1"><a href="labmacro.html#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> sentence <span class="st">&quot;here is a sentence 7&quot;</span></span>
<span id="cb25-2"><a href="labmacro.html#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> w2: <span class="fu">word</span> 4 <span class="kw">of</span> <span class="ot">`sentence&#39;</span></span>
<span id="cb25-3"><a href="labmacro.html#cb25-3" aria-hidden="true" tabindex="-1"></a>mac <span class="ot">list</span> _w2</span></code></pre></div>
<pre><code>_w2:            sentence</code></pre>
<div class="sourceCode" id="cb27"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb27-1"><a href="labmacro.html#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> sentence <span class="st">&quot;here is a sentence 7&quot;</span></span>
<span id="cb27-2"><a href="labmacro.html#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> len: <span class="fu">word</span> <span class="fu">count</span> <span class="ot">`sentence&#39;</span></span>
<span id="cb27-3"><a href="labmacro.html#cb27-3" aria-hidden="true" tabindex="-1"></a>mac <span class="ot">list</span> _len</span></code></pre></div>
<pre><code>_len:           5</code></pre>
<div class="sourceCode" id="cb29"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb29-1"><a href="labmacro.html#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> phrase 2 guys 1 girl 1 pizza place</span>
<span id="cb29-2"><a href="labmacro.html#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="kw">di</span> <span class="st">&quot;`:word 2 of `phrase&#39; &#39;&quot;</span></span></code></pre></div>
<pre><code>guys</code></pre>
<div class="sourceCode" id="cb31"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb31-1"><a href="labmacro.html#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> phrase <span class="st">&quot;2 guys&quot;</span> <span class="st">&quot;1 girl&quot;</span> <span class="st">&quot;1 pizza place&quot;</span></span>
<span id="cb31-2"><a href="labmacro.html#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="kw">di</span> <span class="st">&quot;`:word 2 of `phrase&#39; &#39;&quot;</span></span></code></pre></div>
<pre><code>guys</code></pre>
<div class="sourceCode" id="cb33"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb33-1"><a href="labmacro.html#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> phrase <span class="st">`&quot;</span> <span class="st">&quot;2 guys&quot;</span> <span class="st">&quot;1 girl&quot;</span> <span class="st">&quot;1 pizza place&quot;</span> <span class="st">&quot;&#39;</span></span>
<span id="cb33-2"><a href="labmacro.html#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="st">di &quot;</span><span class="ot">`:word 2 of `phrase&#39;</span> &#39;<span class="st">&quot;</span></span></code></pre></div>
<pre><code>1 girl</code></pre>
<p>Variablen mit bestimmten Eigenschaften identifizieren in ein <code>macro</code></p>
<div class="sourceCode" id="cb35"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb35-1"><a href="labmacro.html#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="kw">ds</span>, has(<span class="dv">type</span> <span class="kw">byte</span>)</span>
<span id="cb35-2"><a href="labmacro.html#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="kw">global</span> bytevars <span class="ot">`r(varlist)&#39;</span></span>
<span id="cb35-3"><a href="labmacro.html#cb35-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-4"><a href="labmacro.html#cb35-4" aria-hidden="true" tabindex="-1"></a><span class="kw">foreach</span> v <span class="kw">of</span> <span class="kw">global</span> bytevars {</span>
<span id="cb35-5"><a href="labmacro.html#cb35-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">rename</span> <span class="ot">`v&#39;</span> B<span class="ot">`v&#39;</span></span>
<span id="cb35-6"><a href="labmacro.html#cb35-6" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="regres.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["Progammieren mit Stata BIBB.pdf", "Progammieren mit Stata BIBB.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
